<%- include('../partials/_header') %>

<div class="container-fluid my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Doctor Dashboard</h1>
        <a href="/doctor/logout" class="btn btn-danger"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <%- include('../partials/_messages') %>

    <div class="card mb-4">
        <div class="card-header">
            <h4>Filter Donors</h4>
        </div>
        <div class="card-body">
            <form action="/doctor/dashboard" method="GET" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label for="bloodGroupFilter" class="form-label">Blood Group</label>
                    <select class="form-select" id="bloodGroupFilter" name="bloodGroup">
                        <option value="">All</option>
                        <% ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'].forEach(group => { %>
                            <option value="<%= group %>" <%= (currentFilters.bloodGroup && currentFilters.bloodGroup == group) ? 'selected' : '' %>><%= group %></option>
                        <% }); %>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="cityFilter" class="form-label">City</label>
                    <input type="text" class="form-control" id="cityFilter" name="city" value="<%= currentFilters.city || '' %>" placeholder="Enter City">
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h4>Available Donors (<%= donors.length %>)</h4>
            <small class="text-muted">Showing donors whose validity period has not expired.</small>
        </div>
        <div class="card-body">
            <% if (donors.length > 0) { %>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Contact</th>
                                <th>Blood Group</th>
                                <th>City</th>
                                <th>Last Donation</th>
                                <th>Valid Until</th>
                                <th>Registered On</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% donors.forEach(donor => { %>
                                <tr>
                                    <td><%= donor.name %></td>
                                    <td><%= donor.contact %></td>
                                    <td><span class="badge bg-danger"><%= donor.bloodGroup %></span></td>
                                    <td><%= donor.city %></td>
                                    <td><%= donor.lastDonationDate.toLocaleDateString() %></td>
                                    <td><%= donor.validUntil.toLocaleDateString() %></td>
                                    <td><%= donor.createdAt.toLocaleDateString() %></td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <p class="text-center">No available donors found matching your criteria.</p>
            <% } %>
        </div>
    </div>
</div>

<%- include('../partials/_footer') %>